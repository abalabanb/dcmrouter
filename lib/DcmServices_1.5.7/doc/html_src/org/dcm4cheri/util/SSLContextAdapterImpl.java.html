<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<HTML>
<HEAD>
<LINK REL=STYLESHEET TYPE="text/css" HREF="../../../stylesheet.css" TITLE="Style">
<META NAME="GENERATOR" CONTENT="Java2HTML Version 1.0.9">
<TITLE>org.dcm4cheri.util.SSLContextAdapterImpl (Java2HTML)</TITLE>
</HEAD>
<BODY><TABLE id="Header" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2" width="33%">&nbsp;</td>
<td align="center" colspan="2" width="33%">
<font size="4">SSLContextAdapterImpl</font>
</td>
<td align="right" colspan="2" width="33%"></td>
</tr>
</TABLE>
<pre ID="Classes">
<A NAME="1"></A><FONT ID="MultiLineComment">/* ***** BEGIN LICENSE BLOCK *****
<A NAME="2"></A> * Version: MPL 1.1/GPL 2.0/LGPL 2.1
<A NAME="3"></A> *
<A NAME="4"></A> * The contents of this file are subject to the Mozilla Public License Version
<A NAME="5"></A> * 1.1 (the "License"); you may not use this file except in compliance with
<A NAME="6"></A> * the License. You may obtain a copy of the License at
<A NAME="7"></A> * http://www.mozilla.org/MPL/
<A NAME="8"></A> *
<A NAME="9"></A> * Software distributed under the License is distributed on an "AS IS" basis,
<A NAME="10"></A> * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
<A NAME="11"></A> * for the specific language governing rights and limitations under the
<A NAME="12"></A> * License.
<A NAME="13"></A> *
<A NAME="14"></A> * The Original Code is part of dcm4che, an implementation of DICOM(TM) in
<A NAME="15"></A> * Java(TM), hosted at http://sourceforge.net/projects/dcm4che.
<A NAME="16"></A> *
<A NAME="17"></A> * The Initial Developer of the Original Code is
<A NAME="18"></A> * TIANI Medgraph AG.
<A NAME="19"></A> * Portions created by the Initial Developer are Copyright (C) 2002-2005
<A NAME="20"></A> * the Initial Developer. All Rights Reserved.
<A NAME="21"></A> *
<A NAME="22"></A> * Contributor(s):
<A NAME="23"></A> * Gunter Zeilinger &lt;gunter.zeilinger@tiani.com&gt;
<A NAME="24"></A> *
<A NAME="25"></A> * Alternatively, the contents of this file may be used under the terms of
<A NAME="26"></A> * either the GNU General Public License Version 2 or later (the "GPL"), or
<A NAME="27"></A> * the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
<A NAME="28"></A> * in which case the provisions of the GPL or the LGPL are applicable instead
<A NAME="29"></A> * of those above. If you wish to allow use of your version of this file only
<A NAME="30"></A> * under the terms of either the GPL or the LGPL, and not to allow others to
<A NAME="31"></A> * use your version of this file under the terms of the MPL, indicate your
<A NAME="32"></A> * decision by deleting the provisions above and replace them with the notice
<A NAME="33"></A> * and other provisions required by the GPL or the LGPL. If you do not delete
<A NAME="34"></A> * the provisions above, a recipient may use your version of this file under
<A NAME="35"></A> * the terms of any one of the MPL, the GPL or the LGPL.
<A NAME="36"></A> *
<A NAME="37"></A> * ***** END LICENSE BLOCK ***** */</FONT>
<A NAME="38"></A>
<A NAME="39"></A><FONT ID="Package">package</FONT> <A HREF="../../../org.dcm4cheri.util.index.html" target="packageFrame">org.dcm4cheri.util</A>;
<A NAME="40"></A>
<A NAME="41"></A><FONT ID="Import">import</FONT> java.io.BufferedInputStream;
<A NAME="42"></A><FONT ID="Import">import</FONT> java.io.File;
<A NAME="43"></A><FONT ID="Import">import</FONT> java.io.FileInputStream;
<A NAME="44"></A><FONT ID="Import">import</FONT> java.io.IOException;
<A NAME="45"></A><FONT ID="Import">import</FONT> java.io.InputStream;
<A NAME="46"></A><FONT ID="Import">import</FONT> java.net.InetAddress;
<A NAME="47"></A><FONT ID="Import">import</FONT> java.net.MalformedURLException;
<A NAME="48"></A><FONT ID="Import">import</FONT> java.net.ServerSocket;
<A NAME="49"></A><FONT ID="Import">import</FONT> java.net.Socket;
<A NAME="50"></A><FONT ID="Import">import</FONT> java.net.URL;
<A NAME="51"></A><FONT ID="Import">import</FONT> java.security.GeneralSecurityException;
<A NAME="52"></A><FONT ID="Import">import</FONT> java.security.KeyStore;
<A NAME="53"></A><FONT ID="Import">import</FONT> java.security.SecureRandom;
<A NAME="54"></A><FONT ID="Import">import</FONT> java.security.Security;
<A NAME="55"></A><FONT ID="Import">import</FONT> java.security.cert.CertificateException;
<A NAME="56"></A><FONT ID="Import">import</FONT> java.security.cert.X509Certificate;
<A NAME="57"></A><FONT ID="Import">import</FONT> java.util.ArrayList;
<A NAME="58"></A><FONT ID="Import">import</FONT> java.util.Arrays;
<A NAME="59"></A><FONT ID="Import">import</FONT> java.util.List;
<A NAME="60"></A><FONT ID="Import">import</FONT> javax.net.ServerSocketFactory;
<A NAME="61"></A><FONT ID="Import">import</FONT> javax.net.SocketFactory;
<A NAME="62"></A><FONT ID="Import">import</FONT> javax.net.ssl.HandshakeCompletedListener;
<A NAME="63"></A><FONT ID="Import">import</FONT> javax.net.ssl.KeyManager;
<A NAME="64"></A><FONT ID="Import">import</FONT> javax.net.ssl.KeyManagerFactory;
<A NAME="65"></A><FONT ID="Import">import</FONT> javax.net.ssl.SSLContext;
<A NAME="66"></A><FONT ID="Import">import</FONT> javax.net.ssl.SSLPeerUnverifiedException;
<A NAME="67"></A><FONT ID="Import">import</FONT> javax.net.ssl.SSLServerSocket;
<A NAME="68"></A><FONT ID="Import">import</FONT> javax.net.ssl.SSLServerSocketFactory;
<A NAME="69"></A><FONT ID="Import">import</FONT> javax.net.ssl.SSLSession;
<A NAME="70"></A><FONT ID="Import">import</FONT> javax.net.ssl.SSLSocket;
<A NAME="71"></A><FONT ID="Import">import</FONT> javax.net.ssl.SSLSocketFactory;
<A NAME="72"></A><FONT ID="Import">import</FONT> javax.net.ssl.TrustManager;
<A NAME="73"></A><FONT ID="Import">import</FONT> javax.net.ssl.TrustManagerFactory;
<A NAME="74"></A>
<A NAME="75"></A><FONT ID="Import">import</FONT> org.apache.log4j.Logger;
<A NAME="76"></A><FONT ID="Import">import</FONT> org.dcm4che.util.HandshakeFailedEvent;
<A NAME="77"></A><FONT ID="Import">import</FONT> org.dcm4che.util.HandshakeFailedListener;
<A NAME="78"></A>
<A NAME="79"></A><FONT ID="Import">import</FONT> org.dcm4che.util.SSLContextAdapter;
<A NAME="80"></A>
<A NAME="81"></A><FONT ID="FormalComment">/**
<A NAME="82"></A> * &lt;description&gt;
<A NAME="83"></A> *
<A NAME="84"></A> * @author     &lt;a href="mailto:gunter@tiani.com"&gt;gunter zeilinger&lt;/a&gt;
<A NAME="85"></A> * @created    Juni 2002
<A NAME="86"></A> * @version    $Revision: 1.12 $ $Date: 2005/10/05 16:26:16 $
<A NAME="87"></A> */</FONT>
<A NAME="88"></A><FONT ID="Public">public</FONT> <FONT ID="Class">class</FONT> SSLContextAdapterImpl <FONT ID="Extends">extends</FONT> SSLContextAdapter
<A NAME="89"></A>{
<A NAME="90"></A>    <FONT ID="SingleLineComment">// Constants -----------------------------------------------------
<A NAME="91"></A></FONT>
<A NAME="92"></A>    <FONT ID="SingleLineComment">// Attributes ----------------------------------------------------
<A NAME="93"></A></FONT>    <FONT ID="Final">final</FONT> <FONT ID="Static">static</FONT> Logger log = Logger.getLogger(<A HREF="../../../org/dcm4cheri/util/SSLContextAdapterImpl.java.html">SSLContextAdapterImpl</A>.<FONT ID="Class">class</FONT>);
<A NAME="94"></A>
<A NAME="95"></A>    <FONT ID="Private">private</FONT> String[] protocols = {
<A NAME="96"></A>            <FONT ID="StringLiteral">"TLSv1"</FONT>,
<A NAME="97"></A>        <FONT ID="StringLiteral">"SSLv3"</FONT>,
<A NAME="98"></A>    <FONT ID="SingleLineComment">//    "SSLv2Hello"
<A NAME="99"></A></FONT>            };
<A NAME="100"></A>    <FONT ID="MultiLineComment">/*
<A NAME="101"></A>    private String[] cipherSuites = {
<A NAME="102"></A>        "SSL_RSA_WITH_3DES_EDE_CBC_SHA",
<A NAME="103"></A>        "SSL_RSA_WITH_NULL_SHA"
<A NAME="104"></A>    };
<A NAME="105"></A>  */</FONT>
<A NAME="106"></A>    <FONT ID="Private">private</FONT> <FONT ID="Final">final</FONT> SSLContext ctx;
<A NAME="107"></A>    <FONT ID="Private">private</FONT> <FONT ID="Final">final</FONT> KeyManagerFactory kmf;
<A NAME="108"></A>    <FONT ID="Private">private</FONT> <FONT ID="Final">final</FONT> TrustManagerFactory tmf;
<A NAME="109"></A>    <FONT ID="Private">private</FONT> SecureRandom random = <FONT ID="Null">null</FONT>;
<A NAME="110"></A>    <FONT ID="Private">private</FONT> KeyManager[] kms = <FONT ID="Null">null</FONT>;
<A NAME="111"></A>    <FONT ID="Private">private</FONT> TrustManager[] tms = <FONT ID="Null">null</FONT>;
<A NAME="112"></A>    <FONT ID="Private">private</FONT> <FONT ID="Boolean">boolean</FONT> dirty = <FONT ID="True">true</FONT>;
<A NAME="113"></A>    <FONT ID="Private">private</FONT> <FONT ID="Boolean">boolean</FONT> needClientAuth = <FONT ID="True">true</FONT>;
<A NAME="114"></A>    <FONT ID="Private">private</FONT> SSLServerSocket unboundSSLServerSocket = <FONT ID="Null">null</FONT>;
<A NAME="115"></A>    <FONT ID="Private">private</FONT> List hcl = <FONT ID="Null">null</FONT>;
<A NAME="116"></A>    <FONT ID="Private">private</FONT> List hfl = <FONT ID="Null">null</FONT>;
<A NAME="117"></A>
<A NAME="118"></A>    <FONT ID="SingleLineComment">// Static --------------------------------------------------------
<A NAME="119"></A></FONT>    <FONT ID="FormalComment">/**
<A NAME="120"></A>     *  The main program for the SSLContextAdapterImpl class
<A NAME="121"></A>     *
<A NAME="122"></A>     * @param  args           The command line arguments
<A NAME="123"></A>     * @exception  Exception  Description of the Exception
<A NAME="124"></A>     */</FONT>
<A NAME="125"></A>    <FONT ID="Public">public</FONT> <FONT ID="Static">static</FONT> <FONT ID="Void">void</FONT> main(String[] args)
<A NAME="126"></A>        <FONT ID="Throws">throws</FONT> Exception
<A NAME="127"></A>    {
<A NAME="128"></A>        SSLContextAdapter inst = <FONT ID="New">new</FONT> <A HREF="../../../org/dcm4cheri/util/SSLContextAdapterImpl.java.html">SSLContextAdapterImpl</A>();
<A NAME="129"></A>        System.out.println(<FONT ID="StringLiteral">"SupportedCipherSuites"</FONT>
<A NAME="130"></A>                 + Arrays.asList(inst.getSupportedCipherSuites()));
<A NAME="131"></A>        System.out.println(<FONT ID="StringLiteral">"SupportedProtocols"</FONT>
<A NAME="132"></A>                 + Arrays.asList(inst.getSupportedProtocols()));
<A NAME="133"></A>    }
<A NAME="134"></A>
<A NAME="135"></A>    <FONT ID="SingleLineComment">// Constructors --------------------------------------------------
<A NAME="136"></A></FONT>    <FONT ID="FormalComment">/**Constructor for the SSLContextAdapterImpl object */</FONT>
<A NAME="137"></A>    <FONT ID="Public">public</FONT> SSLContextAdapterImpl()
<A NAME="138"></A>    {
<A NAME="139"></A>        Security.addProvider(<FONT ID="New">new</FONT> com.sun.net.ssl.internal.ssl.Provider());
<A NAME="140"></A>        <FONT ID="Try">try</FONT> {
<A NAME="141"></A>            ctx = SSLContext.getInstance(<FONT ID="StringLiteral">"TLS"</FONT>);
<A NAME="142"></A>            kmf = KeyManagerFactory.getInstance(
<A NAME="143"></A>                    KeyManagerFactory.getDefaultAlgorithm());
<A NAME="144"></A>            tmf = TrustManagerFactory.getInstance(
<A NAME="145"></A>                    TrustManagerFactory.getDefaultAlgorithm());
<A NAME="146"></A>        } <FONT ID="Catch">catch</FONT> (GeneralSecurityException e) {
<A NAME="147"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> ConfigurationError(<FONT ID="StringLiteral">"could not instantiate SSLContext"</FONT>, e);
<A NAME="148"></A>        }
<A NAME="149"></A>    }
<A NAME="150"></A>
<A NAME="151"></A>    <FONT ID="SingleLineComment">// Public --------------------------------------------------------
<A NAME="152"></A></FONT>    <FONT ID="FormalComment">/**
<A NAME="153"></A>     *  Description of the Method
<A NAME="154"></A>     *
<A NAME="155"></A>     * @return    Description of the Return Value
<A NAME="156"></A>     */</FONT>
<A NAME="157"></A>    <FONT ID="Public">public</FONT> String toString()
<A NAME="158"></A>    {
<A NAME="159"></A>        <FONT ID="Return">return</FONT> ctx.toString();
<A NAME="160"></A>    }
<A NAME="161"></A>
<A NAME="162"></A>    <FONT ID="SingleLineComment">// SSLContextAdapter implementation ------------------------------
<A NAME="163"></A></FONT>    <FONT ID="FormalComment">/**
<A NAME="164"></A>     *  Adds a feature to the HandshakeCompletedListener attribute of the SSLContextAdapterImpl object
<A NAME="165"></A>     *
<A NAME="166"></A>     * @param  listener  The feature to be added to the HandshakeCompletedListener attribute
<A NAME="167"></A>     */</FONT>
<A NAME="168"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> addHandshakeCompletedListener(
<A NAME="169"></A>            HandshakeCompletedListener listener)
<A NAME="170"></A>    {
<A NAME="171"></A>        hcl = addToList(hcl, listener);
<A NAME="172"></A>    }
<A NAME="173"></A>
<A NAME="174"></A>
<A NAME="175"></A>    <FONT ID="FormalComment">/**
<A NAME="176"></A>     *  Adds a feature to the HandshakeFailedListener attribute of the SSLContextAdapterImpl object
<A NAME="177"></A>     *
<A NAME="178"></A>     * @param  listener  The feature to be added to the HandshakeFailedListener attribute
<A NAME="179"></A>     */</FONT>
<A NAME="180"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> addHandshakeFailedListener(
<A NAME="181"></A>            HandshakeFailedListener listener)
<A NAME="182"></A>    {
<A NAME="183"></A>        hfl = addToList(hfl, listener);
<A NAME="184"></A>    }
<A NAME="185"></A>
<A NAME="186"></A>
<A NAME="187"></A>    <FONT ID="FormalComment">/**
<A NAME="188"></A>     *  Description of the Method
<A NAME="189"></A>     *
<A NAME="190"></A>     * @param  listener  Description of the Parameter
<A NAME="191"></A>     */</FONT>
<A NAME="192"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> removeHandshakeCompletedListener(
<A NAME="193"></A>            HandshakeCompletedListener listener)
<A NAME="194"></A>    {
<A NAME="195"></A>        hcl = removeFromList(hcl, listener);
<A NAME="196"></A>    }
<A NAME="197"></A>
<A NAME="198"></A>
<A NAME="199"></A>    <FONT ID="FormalComment">/**
<A NAME="200"></A>     *  Description of the Method
<A NAME="201"></A>     *
<A NAME="202"></A>     * @param  listener  Description of the Parameter
<A NAME="203"></A>     */</FONT>
<A NAME="204"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> removeHandshakeFailedListener(
<A NAME="205"></A>            HandshakeFailedListener listener)
<A NAME="206"></A>    {
<A NAME="207"></A>        hfl = removeFromList(hfl, listener);
<A NAME="208"></A>    }
<A NAME="209"></A>    <FONT ID="SingleLineComment">// Listeners
<A NAME="210"></A></FONT>
<A NAME="211"></A>    <FONT ID="SingleLineComment">// Add an element to a list, creating a new list if the
<A NAME="212"></A></FONT>    <FONT ID="SingleLineComment">// existing list is null, and return the list.
<A NAME="213"></A></FONT>    <FONT ID="Static">static</FONT> List addToList(List l, Object elt)
<A NAME="214"></A>    {
<A NAME="215"></A>        <FONT ID="If">if</FONT> (l == <FONT ID="Null">null</FONT>) {
<A NAME="216"></A>            l = <FONT ID="New">new</FONT> ArrayList();
<A NAME="217"></A>        }
<A NAME="218"></A>        l.add(elt);
<A NAME="219"></A>        <FONT ID="Return">return</FONT> l;
<A NAME="220"></A>    }
<A NAME="221"></A>
<A NAME="222"></A>
<A NAME="223"></A>    <FONT ID="SingleLineComment">// Remove an element from a list, discarding the list if the
<A NAME="224"></A></FONT>    <FONT ID="SingleLineComment">// resulting list is empty, and return the list or null.
<A NAME="225"></A></FONT>    <FONT ID="Static">static</FONT> List removeFromList(List l, Object elt)
<A NAME="226"></A>    {
<A NAME="227"></A>        <FONT ID="If">if</FONT> (l == <FONT ID="Null">null</FONT>) {
<A NAME="228"></A>            <FONT ID="Return">return</FONT> l;
<A NAME="229"></A>        }
<A NAME="230"></A>        l.remove(elt);
<A NAME="231"></A>        <FONT ID="If">if</FONT> (l.size() == <FONT ID="IntegerLiteral">0</FONT>) {
<A NAME="232"></A>            l = <FONT ID="Null">null</FONT>;
<A NAME="233"></A>        }
<A NAME="234"></A>        <FONT ID="Return">return</FONT> l;
<A NAME="235"></A>    }
<A NAME="236"></A>
<A NAME="237"></A>
<A NAME="238"></A>    <FONT ID="FormalComment">/**
<A NAME="239"></A>     *  Gets the sSLContext attribute of the SSLContextAdapterImpl object
<A NAME="240"></A>     *
<A NAME="241"></A>     * @return                               The sSLContext value
<A NAME="242"></A>     * @exception  GeneralSecurityException  Description of the Exception
<A NAME="243"></A>     */</FONT>
<A NAME="244"></A>    <FONT ID="Public">public</FONT> SSLContext getSSLContext()
<A NAME="245"></A>        <FONT ID="Throws">throws</FONT> GeneralSecurityException
<A NAME="246"></A>    {
<A NAME="247"></A>        init();
<A NAME="248"></A>        <FONT ID="Return">return</FONT> ctx;
<A NAME="249"></A>    }
<A NAME="250"></A>
<A NAME="251"></A>
<A NAME="252"></A>    <FONT ID="FormalComment">/**
<A NAME="253"></A>     *  Sets the key attribute of the SSLContextAdapterImpl object
<A NAME="254"></A>     *
<A NAME="255"></A>     * @param  key                           The new key value
<A NAME="256"></A>     * @param  password                      The new key value
<A NAME="257"></A>     * @exception  GeneralSecurityException  Description of the Exception
<A NAME="258"></A>     */</FONT>
<A NAME="259"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setKey(KeyStore key, <FONT ID="Char">char</FONT>[] password)
<A NAME="260"></A>        <FONT ID="Throws">throws</FONT> GeneralSecurityException
<A NAME="261"></A>    {
<A NAME="262"></A>        kmf.init(key, password);
<A NAME="263"></A>        kms = kmf.getKeyManagers();
<A NAME="264"></A>        dirty = <FONT ID="True">true</FONT>;
<A NAME="265"></A>    }
<A NAME="266"></A>
<A NAME="267"></A>
<A NAME="268"></A>    <FONT ID="FormalComment">/**
<A NAME="269"></A>     *  Sets the trust attribute of the SSLContextAdapterImpl object
<A NAME="270"></A>     *
<A NAME="271"></A>     * @param  cacerts                       The new trust value
<A NAME="272"></A>     * @exception  GeneralSecurityException  Description of the Exception
<A NAME="273"></A>     */</FONT>
<A NAME="274"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setTrust(KeyStore cacerts)
<A NAME="275"></A>        <FONT ID="Throws">throws</FONT> GeneralSecurityException
<A NAME="276"></A>    {
<A NAME="277"></A>        tmf.init(cacerts);
<A NAME="278"></A>        tms = tmf.getTrustManagers();
<A NAME="279"></A>        dirty = <FONT ID="True">true</FONT>;
<A NAME="280"></A>    }
<A NAME="281"></A>
<A NAME="282"></A>
<A NAME="283"></A>    <FONT ID="FormalComment">/**
<A NAME="284"></A>     *  Gets the keyManagers attribute of the SSLContextAdapterImpl object
<A NAME="285"></A>     *
<A NAME="286"></A>     * @return    The keyManagers value
<A NAME="287"></A>     */</FONT>
<A NAME="288"></A>    <FONT ID="Public">public</FONT> KeyManager[] getKeyManagers()
<A NAME="289"></A>    {
<A NAME="290"></A>        <FONT ID="Return">return</FONT> kms;
<A NAME="291"></A>    }
<A NAME="292"></A>
<A NAME="293"></A>
<A NAME="294"></A>    <FONT ID="FormalComment">/**
<A NAME="295"></A>     *  Gets the trustManagers attribute of the SSLContextAdapterImpl object
<A NAME="296"></A>     *
<A NAME="297"></A>     * @return    The trustManagers value
<A NAME="298"></A>     */</FONT>
<A NAME="299"></A>    <FONT ID="Public">public</FONT> TrustManager[] getTrustManagers()
<A NAME="300"></A>    {
<A NAME="301"></A>        <FONT ID="Return">return</FONT> tms;
<A NAME="302"></A>    }
<A NAME="303"></A>
<A NAME="304"></A>
<A NAME="305"></A>    <FONT ID="FormalComment">/**
<A NAME="306"></A>     *  Description of the Method
<A NAME="307"></A>     *
<A NAME="308"></A>     * @param  seed  Description of the Parameter
<A NAME="309"></A>     */</FONT>
<A NAME="310"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> seedRandom(<FONT ID="Long">long</FONT> seed)
<A NAME="311"></A>    {
<A NAME="312"></A>        <FONT ID="Try">try</FONT> {
<A NAME="313"></A>            random = SecureRandom.getInstance(<FONT ID="StringLiteral">"SHA1PRNG"</FONT>);
<A NAME="314"></A>            random.setSeed(seed);
<A NAME="315"></A>            dirty = <FONT ID="True">true</FONT>;
<A NAME="316"></A>        } <FONT ID="Catch">catch</FONT> (GeneralSecurityException e) {
<A NAME="317"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> ConfigurationError(
<A NAME="318"></A>                    <FONT ID="StringLiteral">"could not instantiate SecureRandom"</FONT>, e);
<A NAME="319"></A>        }
<A NAME="320"></A>    }
<A NAME="321"></A>
<A NAME="322"></A>
<A NAME="323"></A>    <FONT ID="FormalComment">/**
<A NAME="324"></A>     *  Sets the needClientAuth attribute of the SSLContextAdapterImpl object
<A NAME="325"></A>     *
<A NAME="326"></A>     * @param  needClientAuth  The new needClientAuth value
<A NAME="327"></A>     */</FONT>
<A NAME="328"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setNeedClientAuth(<FONT ID="Boolean">boolean</FONT> needClientAuth)
<A NAME="329"></A>    {
<A NAME="330"></A>        <FONT ID="This">this</FONT>.needClientAuth = needClientAuth;
<A NAME="331"></A>    }
<A NAME="332"></A>
<A NAME="333"></A>
<A NAME="334"></A>    <FONT ID="FormalComment">/**
<A NAME="335"></A>     *  Gets the needClientAuth attribute of the SSLContextAdapterImpl object
<A NAME="336"></A>     *
<A NAME="337"></A>     * @return    The needClientAuth value
<A NAME="338"></A>     */</FONT>
<A NAME="339"></A>    <FONT ID="Public">public</FONT> <FONT ID="Boolean">boolean</FONT> isNeedClientAuth()
<A NAME="340"></A>    {
<A NAME="341"></A>        <FONT ID="Return">return</FONT> needClientAuth;
<A NAME="342"></A>    }
<A NAME="343"></A>
<A NAME="344"></A>
<A NAME="345"></A>    <FONT ID="FormalComment">/**
<A NAME="346"></A>     *  Sets the enabledProtocols attribute of the SSLContextAdapterImpl object
<A NAME="347"></A>     *
<A NAME="348"></A>     * @param  protocols  The new enabledProtocols value
<A NAME="349"></A>     */</FONT>
<A NAME="350"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> setEnabledProtocols(String[] protocols)
<A NAME="351"></A>    {
<A NAME="352"></A>        <FONT ID="This">this</FONT>.protocols = (String[]) protocols.clone();
<A NAME="353"></A>    }
<A NAME="354"></A>
<A NAME="355"></A>
<A NAME="356"></A>    <FONT ID="FormalComment">/**
<A NAME="357"></A>     *  Gets the enabledProtocols attribute of the SSLContextAdapterImpl object
<A NAME="358"></A>     *
<A NAME="359"></A>     * @return    The enabledProtocols value
<A NAME="360"></A>     */</FONT>
<A NAME="361"></A>    <FONT ID="Public">public</FONT> String[] getEnabledProtocols()
<A NAME="362"></A>    {
<A NAME="363"></A>        <FONT ID="Return">return</FONT> (String[]) protocols.clone();
<A NAME="364"></A>    }
<A NAME="365"></A>
<A NAME="366"></A>
<A NAME="367"></A>    <FONT ID="MultiLineComment">/*
<A NAME="368"></A>    public void setEnabledCipherSuites(String[] cipherSuites) {
<A NAME="369"></A>        this.cipherSuites = (String[])cipherSuites.clone();
<A NAME="370"></A>    }
<A NAME="371"></A>    public String[] getEnabledCipherSuites() {
<A NAME="372"></A>        return (String[])cipherSuites.clone();
<A NAME="373"></A>    }
<A NAME="374"></A>  */</FONT>
<A NAME="375"></A>    <FONT ID="Private">private</FONT> SSLServerSocket getUnboundSSLServerSocket()
<A NAME="376"></A>    {
<A NAME="377"></A>        <FONT ID="If">if</FONT> (unboundSSLServerSocket != <FONT ID="Null">null</FONT>) {
<A NAME="378"></A>            <FONT ID="Return">return</FONT> unboundSSLServerSocket;
<A NAME="379"></A>        }
<A NAME="380"></A>        <FONT ID="Try">try</FONT> {
<A NAME="381"></A>            ServerSocketFactory factory = ctx.getServerSocketFactory();
<A NAME="382"></A>            unboundSSLServerSocket = (SSLServerSocket) factory.createServerSocket();
<A NAME="383"></A>        } <FONT ID="Catch">catch</FONT> (IOException e) {
<A NAME="384"></A>            <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> ConfigurationError(
<A NAME="385"></A>                    <FONT ID="StringLiteral">"could not create unbounded ServerSocket"</FONT>, e);
<A NAME="386"></A>        }
<A NAME="387"></A>        <FONT ID="Return">return</FONT> unboundSSLServerSocket;
<A NAME="388"></A>    }
<A NAME="389"></A>
<A NAME="390"></A>
<A NAME="391"></A>    <FONT ID="FormalComment">/**
<A NAME="392"></A>     *  Gets the supportedCipherSuites attribute of the SSLContextAdapterImpl object
<A NAME="393"></A>     *
<A NAME="394"></A>     * @return    The supportedCipherSuites value
<A NAME="395"></A>     */</FONT>
<A NAME="396"></A>    <FONT ID="Public">public</FONT> String[] getSupportedCipherSuites()
<A NAME="397"></A>    {
<A NAME="398"></A>        <FONT ID="Return">return</FONT> getUnboundSSLServerSocket().getSupportedCipherSuites();
<A NAME="399"></A>    }
<A NAME="400"></A>
<A NAME="401"></A>
<A NAME="402"></A>    <FONT ID="FormalComment">/**
<A NAME="403"></A>     *  Gets the supportedProtocols attribute of the SSLContextAdapterImpl object
<A NAME="404"></A>     *
<A NAME="405"></A>     * @return    The supportedProtocols value
<A NAME="406"></A>     */</FONT>
<A NAME="407"></A>    <FONT ID="Public">public</FONT> String[] getSupportedProtocols()
<A NAME="408"></A>    {
<A NAME="409"></A>        <FONT ID="Return">return</FONT> getUnboundSSLServerSocket().getSupportedProtocols();
<A NAME="410"></A>    }
<A NAME="411"></A>
<A NAME="412"></A>
<A NAME="413"></A>    <FONT ID="MultiLineComment">/*
<A NAME="414"></A>    public ServerSocketFactory getServerSocketFactory() {
<A NAME="415"></A>        return new SSLServerSocketFactoryAdapter(cipherSuites);
<A NAME="416"></A>    }
<A NAME="417"></A>*/</FONT>
<A NAME="418"></A>    <FONT ID="FormalComment">/**
<A NAME="419"></A>     *  Gets the serverSocketFactory attribute of the SSLContextAdapterImpl object
<A NAME="420"></A>     *
<A NAME="421"></A>     * @param  cipherSuites                  Description of the Parameter
<A NAME="422"></A>     * @return                               The serverSocketFactory value
<A NAME="423"></A>     * @exception  GeneralSecurityException  Description of the Exception
<A NAME="424"></A>     */</FONT>
<A NAME="425"></A>    <FONT ID="Public">public</FONT> ServerSocketFactory getServerSocketFactory(String[] cipherSuites)
<A NAME="426"></A>        <FONT ID="Throws">throws</FONT> GeneralSecurityException
<A NAME="427"></A>    {
<A NAME="428"></A>        <FONT ID="Return">return</FONT> <FONT ID="New">new</FONT> SSLServerSocketFactoryAdapter(cipherSuites);
<A NAME="429"></A>    }
<A NAME="430"></A>
<A NAME="431"></A>
<A NAME="432"></A>    <FONT ID="MultiLineComment">/*
<A NAME="433"></A>    public SocketFactory getSocketFactory() {
<A NAME="434"></A>        return new SSLSocketFactoryAdapter(cipherSuites);
<A NAME="435"></A>    }
<A NAME="436"></A>*/</FONT>
<A NAME="437"></A>    <FONT ID="FormalComment">/**
<A NAME="438"></A>     *  Gets the socketFactory attribute of the SSLContextAdapterImpl object
<A NAME="439"></A>     *
<A NAME="440"></A>     * @param  cipherSuites                  Description of the Parameter
<A NAME="441"></A>     * @return                               The socketFactory value
<A NAME="442"></A>     * @exception  GeneralSecurityException  Description of the Exception
<A NAME="443"></A>     */</FONT>
<A NAME="444"></A>    <FONT ID="Public">public</FONT> SocketFactory getSocketFactory(String[] cipherSuites)
<A NAME="445"></A>        <FONT ID="Throws">throws</FONT> GeneralSecurityException
<A NAME="446"></A>    {
<A NAME="447"></A>        <FONT ID="Return">return</FONT> <FONT ID="New">new</FONT> SSLSocketFactoryAdapter(cipherSuites);
<A NAME="448"></A>    }
<A NAME="449"></A>
<A NAME="450"></A>
<A NAME="451"></A>    <FONT ID="FormalComment">/**
<A NAME="452"></A>     *  Description of the Method
<A NAME="453"></A>     *
<A NAME="454"></A>     * @exception  GeneralSecurityException  Description of the Exception
<A NAME="455"></A>     */</FONT>
<A NAME="456"></A>    <FONT ID="Public">public</FONT> <FONT ID="Void">void</FONT> init()
<A NAME="457"></A>        <FONT ID="Throws">throws</FONT> GeneralSecurityException
<A NAME="458"></A>    {
<A NAME="459"></A>        <FONT ID="If">if</FONT> (dirty) {
<A NAME="460"></A>            ctx.init(kms, tms, random);
<A NAME="461"></A>            dirty = <FONT ID="False">false</FONT>;
<A NAME="462"></A>        }
<A NAME="463"></A>    }
<A NAME="464"></A>
<A NAME="465"></A>    <FONT ID="SingleLineComment">// Package protected ---------------------------------------------
<A NAME="466"></A></FONT>
<A NAME="467"></A>    <FONT ID="SingleLineComment">// Protected -----------------------------------------------------
<A NAME="468"></A></FONT>
<A NAME="469"></A>    <FONT ID="SingleLineComment">// Private -------------------------------------------------------
<A NAME="470"></A></FONT>    <FONT ID="Private">private</FONT> String toKeyStoreType(String fname)
<A NAME="471"></A>    {
<A NAME="472"></A>        <FONT ID="Return">return</FONT> fname.endsWith(<FONT ID="StringLiteral">".p12"</FONT>)
<A NAME="473"></A>                 || fname.endsWith(<FONT ID="StringLiteral">".P12"</FONT>)
<A NAME="474"></A>                 ? <FONT ID="StringLiteral">"PKCS12"</FONT> : <FONT ID="StringLiteral">"JKS"</FONT>;
<A NAME="475"></A>    }
<A NAME="476"></A>
<A NAME="477"></A>
<A NAME="478"></A>    <FONT ID="FormalComment">/**
<A NAME="479"></A>     *  Description of the Method
<A NAME="480"></A>     *
<A NAME="481"></A>     * @param  url                           Description of the Parameter
<A NAME="482"></A>     * @param  password                      Description of the Parameter
<A NAME="483"></A>     * @return                               Description of the Return Value
<A NAME="484"></A>     * @exception  GeneralSecurityException  Description of the Exception
<A NAME="485"></A>     * @exception  IOException               Description of the Exception
<A NAME="486"></A>     */</FONT>
<A NAME="487"></A>    <FONT ID="Public">public</FONT> KeyStore loadKeyStore(URL url, <FONT ID="Char">char</FONT>[] password)
<A NAME="488"></A>        <FONT ID="Throws">throws</FONT> GeneralSecurityException, IOException
<A NAME="489"></A>    {
<A NAME="490"></A>        InputStream in = url.openStream();
<A NAME="491"></A>        <FONT ID="Try">try</FONT> {
<A NAME="492"></A>            <FONT ID="Return">return</FONT> loadKeyStore(in, password, toKeyStoreType(url.getPath()));
<A NAME="493"></A>        } <FONT ID="Finally">finally</FONT> {
<A NAME="494"></A>            <FONT ID="Try">try</FONT> {
<A NAME="495"></A>                in.close();
<A NAME="496"></A>            } <FONT ID="Catch">catch</FONT> (IOException ignore) {}
<A NAME="497"></A>        }
<A NAME="498"></A>    }
<A NAME="499"></A>
<A NAME="500"></A>    <FONT ID="Public">public</FONT> KeyStore loadKeyStore(String url, <FONT ID="Char">char</FONT>[] password)
<A NAME="501"></A>    <FONT ID="Throws">throws</FONT> GeneralSecurityException, IOException
<A NAME="502"></A>  {
<A NAME="503"></A>      <FONT ID="Try">try</FONT> {
<A NAME="504"></A>        <FONT ID="Return">return</FONT> loadKeyStore(<FONT ID="New">new</FONT> URL(url), password);
<A NAME="505"></A>      } <FONT ID="Catch">catch</FONT> (MalformedURLException e) {
<A NAME="506"></A>        <FONT ID="Return">return</FONT> loadKeyStore(<FONT ID="New">new</FONT> File(url), password);
<A NAME="507"></A>      }
<A NAME="508"></A>    }
<A NAME="509"></A>    
<A NAME="510"></A>    <FONT ID="FormalComment">/**
<A NAME="511"></A>     *  Description of the Method
<A NAME="512"></A>     *
<A NAME="513"></A>     * @param  file                          Description of the Parameter
<A NAME="514"></A>     * @param  password                      Description of the Parameter
<A NAME="515"></A>     * @return                               Description of the Return Value
<A NAME="516"></A>     * @exception  GeneralSecurityException  Description of the Exception
<A NAME="517"></A>     * @exception  IOException               Description of the Exception
<A NAME="518"></A>     */</FONT>
<A NAME="519"></A>    <FONT ID="Public">public</FONT> KeyStore loadKeyStore(File file, <FONT ID="Char">char</FONT>[] password)
<A NAME="520"></A>        <FONT ID="Throws">throws</FONT> GeneralSecurityException, IOException
<A NAME="521"></A>    {
<A NAME="522"></A>        InputStream in = <FONT ID="New">new</FONT> BufferedInputStream(<FONT ID="New">new</FONT> FileInputStream(file));
<A NAME="523"></A>        <FONT ID="Try">try</FONT> {
<A NAME="524"></A>            <FONT ID="Return">return</FONT> loadKeyStore(in, password, toKeyStoreType(file.getName()));
<A NAME="525"></A>        } <FONT ID="Finally">finally</FONT> {
<A NAME="526"></A>            <FONT ID="Try">try</FONT> {
<A NAME="527"></A>                in.close();
<A NAME="528"></A>            } <FONT ID="Catch">catch</FONT> (IOException ignore) {}
<A NAME="529"></A>        }
<A NAME="530"></A>    }
<A NAME="531"></A>
<A NAME="532"></A>
<A NAME="533"></A>    <FONT ID="FormalComment">/**
<A NAME="534"></A>     *  Description of the Method
<A NAME="535"></A>     *
<A NAME="536"></A>     * @param  in                            Description of the Parameter
<A NAME="537"></A>     * @param  password                      Description of the Parameter
<A NAME="538"></A>     * @param  type                          Description of the Parameter
<A NAME="539"></A>     * @return                               Description of the Return Value
<A NAME="540"></A>     * @exception  GeneralSecurityException  Description of the Exception
<A NAME="541"></A>     * @exception  IOException               Description of the Exception
<A NAME="542"></A>     */</FONT>
<A NAME="543"></A>    <FONT ID="Public">public</FONT> KeyStore loadKeyStore(InputStream in, <FONT ID="Char">char</FONT>[] password, String type)
<A NAME="544"></A>        <FONT ID="Throws">throws</FONT> GeneralSecurityException, IOException
<A NAME="545"></A>    {
<A NAME="546"></A>        KeyStore key = KeyStore.getInstance(type);
<A NAME="547"></A>        key.load(in, password);
<A NAME="548"></A>        <FONT ID="Return">return</FONT> key;
<A NAME="549"></A>    }
<A NAME="550"></A>
<A NAME="551"></A>    <FONT ID="SingleLineComment">// Inner classes -------------------------------------------------
<A NAME="552"></A></FONT>    <FONT ID="FormalComment">/**
<A NAME="553"></A>     *  Description of the Class
<A NAME="554"></A>     *
<A NAME="555"></A>     * @author     gunter
<A NAME="556"></A>     * @created    March 5, 2003
<A NAME="557"></A>     */</FONT>
<A NAME="558"></A>    <FONT ID="Private">private</FONT> <FONT ID="Class">class</FONT> SSLServerSocketFactoryAdapter <FONT ID="Extends">extends</FONT> ServerSocketFactory
<A NAME="559"></A>    {
<A NAME="560"></A>
<A NAME="561"></A>        <FONT ID="Final">final</FONT> SSLServerSocketFactory ssf;
<A NAME="562"></A>        <FONT ID="Final">final</FONT> String[] cipherSuites;
<A NAME="563"></A>
<A NAME="564"></A>
<A NAME="565"></A>        SSLServerSocketFactoryAdapter(String[] cipherSuites)
<A NAME="566"></A>            <FONT ID="Throws">throws</FONT> GeneralSecurityException
<A NAME="567"></A>        {
<A NAME="568"></A>            ssf = getSSLContext().getServerSocketFactory();
<A NAME="569"></A>            <FONT ID="This">this</FONT>.cipherSuites = cipherSuites != <FONT ID="Null">null</FONT>
<A NAME="570"></A>                     ? (String[]) cipherSuites.clone() : <FONT ID="Null">null</FONT>;
<A NAME="571"></A>        }
<A NAME="572"></A>
<A NAME="573"></A>
<A NAME="574"></A>        <FONT ID="FormalComment">/**
<A NAME="575"></A>         *  Description of the Method
<A NAME="576"></A>         *
<A NAME="577"></A>         * @param  port             Description of the Parameter
<A NAME="578"></A>         * @param  backlog          Description of the Parameter
<A NAME="579"></A>         * @return                  Description of the Return Value
<A NAME="580"></A>         * @exception  IOException  Description of the Exception
<A NAME="581"></A>         */</FONT>
<A NAME="582"></A>        <FONT ID="Public">public</FONT> ServerSocket createServerSocket(<FONT ID="Int">int</FONT> port, <FONT ID="Int">int</FONT> backlog)
<A NAME="583"></A>            <FONT ID="Throws">throws</FONT> IOException
<A NAME="584"></A>        {
<A NAME="585"></A>            <FONT ID="Return">return</FONT> init((SSLServerSocket) ssf.createServerSocket(port, backlog));
<A NAME="586"></A>        }
<A NAME="587"></A>
<A NAME="588"></A>
<A NAME="589"></A>        <FONT ID="FormalComment">/**
<A NAME="590"></A>         *  Description of the Method
<A NAME="591"></A>         *
<A NAME="592"></A>         * @param  port             Description of the Parameter
<A NAME="593"></A>         * @param  backlog          Description of the Parameter
<A NAME="594"></A>         * @param  ia               Description of the Parameter
<A NAME="595"></A>         * @return                  Description of the Return Value
<A NAME="596"></A>         * @exception  IOException  Description of the Exception
<A NAME="597"></A>         */</FONT>
<A NAME="598"></A>        <FONT ID="Public">public</FONT> ServerSocket createServerSocket(<FONT ID="Int">int</FONT> port, <FONT ID="Int">int</FONT> backlog,
<A NAME="599"></A>                InetAddress ia)
<A NAME="600"></A>            <FONT ID="Throws">throws</FONT> IOException
<A NAME="601"></A>        {
<A NAME="602"></A>            <FONT ID="Return">return</FONT> init(
<A NAME="603"></A>                    (SSLServerSocket) ssf.createServerSocket(port, backlog, ia));
<A NAME="604"></A>        }
<A NAME="605"></A>
<A NAME="606"></A>
<A NAME="607"></A>        <FONT ID="FormalComment">/**
<A NAME="608"></A>         *  Description of the Method
<A NAME="609"></A>         *
<A NAME="610"></A>         * @param  port             Description of the Parameter
<A NAME="611"></A>         * @return                  Description of the Return Value
<A NAME="612"></A>         * @exception  IOException  Description of the Exception
<A NAME="613"></A>         */</FONT>
<A NAME="614"></A>        <FONT ID="Public">public</FONT> ServerSocket createServerSocket(<FONT ID="Int">int</FONT> port)
<A NAME="615"></A>            <FONT ID="Throws">throws</FONT> IOException
<A NAME="616"></A>        {
<A NAME="617"></A>            <FONT ID="Return">return</FONT> init((SSLServerSocket) ssf.createServerSocket(port));
<A NAME="618"></A>        }
<A NAME="619"></A>
<A NAME="620"></A>
<A NAME="621"></A>        <FONT ID="Private">private</FONT> ServerSocket init(SSLServerSocket ss)
<A NAME="622"></A>        {
<A NAME="623"></A>            ss.setNeedClientAuth(isNeedClientAuth());
<A NAME="624"></A>            ss.setEnabledProtocols(getEnabledProtocols());
<A NAME="625"></A>            <FONT ID="If">if</FONT> (cipherSuites != <FONT ID="Null">null</FONT>) {
<A NAME="626"></A>                ss.setEnabledCipherSuites(cipherSuites);
<A NAME="627"></A>            }
<A NAME="628"></A>            <FONT ID="Return">return</FONT> ss;
<A NAME="629"></A>        }
<A NAME="630"></A>    }
<A NAME="631"></A>
<A NAME="632"></A>
<A NAME="633"></A>    <FONT ID="FormalComment">/**
<A NAME="634"></A>     *  Description of the Class
<A NAME="635"></A>     *
<A NAME="636"></A>     * @author     gunter
<A NAME="637"></A>     * @created    March 5, 2003
<A NAME="638"></A>     */</FONT>
<A NAME="639"></A>    <FONT ID="Private">private</FONT> <FONT ID="Class">class</FONT> SSLSocketFactoryAdapter <FONT ID="Extends">extends</FONT> SocketFactory
<A NAME="640"></A>    {
<A NAME="641"></A>
<A NAME="642"></A>        <FONT ID="Final">final</FONT> SSLSocketFactory sf;
<A NAME="643"></A>        <FONT ID="Final">final</FONT> String[] cipherSuites;
<A NAME="644"></A>
<A NAME="645"></A>
<A NAME="646"></A>        SSLSocketFactoryAdapter(String[] cipherSuites)
<A NAME="647"></A>            <FONT ID="Throws">throws</FONT> GeneralSecurityException
<A NAME="648"></A>        {
<A NAME="649"></A>            sf = getSSLContext().getSocketFactory();
<A NAME="650"></A>            <FONT ID="This">this</FONT>.cipherSuites = cipherSuites != <FONT ID="Null">null</FONT>
<A NAME="651"></A>                     ? (String[]) cipherSuites.clone() : <FONT ID="Null">null</FONT>;
<A NAME="652"></A>        }
<A NAME="653"></A>
<A NAME="654"></A>
<A NAME="655"></A>        <FONT ID="FormalComment">/**
<A NAME="656"></A>         *  Description of the Method
<A NAME="657"></A>         *
<A NAME="658"></A>         * @param  ia               Description of the Parameter
<A NAME="659"></A>         * @param  port             Description of the Parameter
<A NAME="660"></A>         * @return                  Description of the Return Value
<A NAME="661"></A>         * @exception  IOException  Description of the Exception
<A NAME="662"></A>         */</FONT>
<A NAME="663"></A>        <FONT ID="Public">public</FONT> Socket createSocket(InetAddress ia, <FONT ID="Int">int</FONT> port)
<A NAME="664"></A>            <FONT ID="Throws">throws</FONT> IOException
<A NAME="665"></A>        {
<A NAME="666"></A>            <FONT ID="Return">return</FONT> init((SSLSocket) sf.createSocket(ia, port));
<A NAME="667"></A>        }
<A NAME="668"></A>
<A NAME="669"></A>
<A NAME="670"></A>        <FONT ID="FormalComment">/**
<A NAME="671"></A>         *  Description of the Method
<A NAME="672"></A>         *
<A NAME="673"></A>         * @param  ia               Description of the Parameter
<A NAME="674"></A>         * @param  port             Description of the Parameter
<A NAME="675"></A>         * @param  clientIA         Description of the Parameter
<A NAME="676"></A>         * @param  clientPort       Description of the Parameter
<A NAME="677"></A>         * @return                  Description of the Return Value
<A NAME="678"></A>         * @exception  IOException  Description of the Exception
<A NAME="679"></A>         */</FONT>
<A NAME="680"></A>        <FONT ID="Public">public</FONT> Socket createSocket(InetAddress ia, <FONT ID="Int">int</FONT> port,
<A NAME="681"></A>                InetAddress clientIA, <FONT ID="Int">int</FONT> clientPort)
<A NAME="682"></A>            <FONT ID="Throws">throws</FONT> IOException
<A NAME="683"></A>        {
<A NAME="684"></A>            <FONT ID="Return">return</FONT> init(
<A NAME="685"></A>                    (SSLSocket) sf.createSocket(ia, port, clientIA, clientPort));
<A NAME="686"></A>        }
<A NAME="687"></A>
<A NAME="688"></A>
<A NAME="689"></A>        <FONT ID="FormalComment">/**
<A NAME="690"></A>         *  Description of the Method
<A NAME="691"></A>         *
<A NAME="692"></A>         * @param  host             Description of the Parameter
<A NAME="693"></A>         * @param  port             Description of the Parameter
<A NAME="694"></A>         * @param  clientIA         Description of the Parameter
<A NAME="695"></A>         * @param  clientPort       Description of the Parameter
<A NAME="696"></A>         * @return                  Description of the Return Value
<A NAME="697"></A>         * @exception  IOException  Description of the Exception
<A NAME="698"></A>         */</FONT>
<A NAME="699"></A>        <FONT ID="Public">public</FONT> Socket createSocket(String host, <FONT ID="Int">int</FONT> port,
<A NAME="700"></A>                InetAddress clientIA, <FONT ID="Int">int</FONT> clientPort)
<A NAME="701"></A>            <FONT ID="Throws">throws</FONT> IOException
<A NAME="702"></A>        {
<A NAME="703"></A>            <FONT ID="Return">return</FONT> init(
<A NAME="704"></A>                    (SSLSocket) sf.createSocket(host, port, clientIA, clientPort));
<A NAME="705"></A>        }
<A NAME="706"></A>
<A NAME="707"></A>
<A NAME="708"></A>        <FONT ID="FormalComment">/**
<A NAME="709"></A>         *  Description of the Method
<A NAME="710"></A>         *
<A NAME="711"></A>         * @param  host             Description of the Parameter
<A NAME="712"></A>         * @param  port             Description of the Parameter
<A NAME="713"></A>         * @return                  Description of the Return Value
<A NAME="714"></A>         * @exception  IOException  Description of the Exception
<A NAME="715"></A>         */</FONT>
<A NAME="716"></A>        <FONT ID="Public">public</FONT> Socket createSocket(String host, <FONT ID="Int">int</FONT> port)
<A NAME="717"></A>            <FONT ID="Throws">throws</FONT> IOException
<A NAME="718"></A>        {
<A NAME="719"></A>            <FONT ID="Return">return</FONT> init((SSLSocket) sf.createSocket(host, port));
<A NAME="720"></A>        }
<A NAME="721"></A>
<A NAME="722"></A>
<A NAME="723"></A>        <FONT ID="Private">private</FONT> Socket init(SSLSocket s)
<A NAME="724"></A>            <FONT ID="Throws">throws</FONT> IOException
<A NAME="725"></A>        {
<A NAME="726"></A>            <FONT ID="If">if</FONT> (cipherSuites != <FONT ID="Null">null</FONT>) {
<A NAME="727"></A>                s.setEnabledCipherSuites(cipherSuites);
<A NAME="728"></A>            }
<A NAME="729"></A>            s.setEnabledProtocols(getEnabledProtocols());
<A NAME="730"></A>            <FONT ID="If">if</FONT> (hcl != <FONT ID="Null">null</FONT>) {
<A NAME="731"></A>                <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">0</FONT>, n = hcl.size(); i &lt; n; ++i) {
<A NAME="732"></A>                    s.addHandshakeCompletedListener(
<A NAME="733"></A>                            (HandshakeCompletedListener) hcl.get(i));
<A NAME="734"></A>                }
<A NAME="735"></A>            }
<A NAME="736"></A>            <FONT ID="Try">try</FONT> {
<A NAME="737"></A>                s.startHandshake();
<A NAME="738"></A>                <FONT ID="If">if</FONT> (log.isInfoEnabled()) {
<A NAME="739"></A>                    SSLSession se = s.getSession();
<A NAME="740"></A>                    <FONT ID="Try">try</FONT> {
<A NAME="741"></A>                        X509Certificate cert = (X509Certificate)
<A NAME="742"></A>                                se.getPeerCertificates()[<FONT ID="IntegerLiteral">0</FONT>];
<A NAME="743"></A>                        cert.checkValidity();
<A NAME="744"></A>                        log.info(s.getInetAddress().toString() +
<A NAME="745"></A>                                <FONT ID="StringLiteral">": accept "</FONT> + se.getCipherSuite() + <FONT ID="StringLiteral">" with "</FONT>
<A NAME="746"></A>                                 + cert.getSubjectDN()+<FONT ID="StringLiteral">" valid from "</FONT>+cert.getNotBefore()+<FONT ID="StringLiteral">" to "</FONT>+cert.getNotAfter());
<A NAME="747"></A>                    } <FONT ID="Catch">catch</FONT> (SSLPeerUnverifiedException e) {
<A NAME="748"></A>                        log.error(<FONT ID="StringLiteral">"SSL peer not verified:"</FONT>, e);
<A NAME="749"></A>                    } <FONT ID="Catch">catch</FONT> ( CertificateException ce ) {
<A NAME="750"></A>                      <FONT ID="Throw">throw</FONT> <FONT ID="New">new</FONT> IOException(ce.getMessage());
<A NAME="751"></A>                    }
<A NAME="752"></A>                }
<A NAME="753"></A>            } <FONT ID="Catch">catch</FONT> (IOException e) {
<A NAME="754"></A>                <FONT ID="If">if</FONT> (hfl != <FONT ID="Null">null</FONT>) {
<A NAME="755"></A>                    HandshakeFailedEvent event = <FONT ID="New">new</FONT> HandshakeFailedEvent(s, e);
<A NAME="756"></A>                    <FONT ID="For">for</FONT> (<FONT ID="Int">int</FONT> i = <FONT ID="IntegerLiteral">0</FONT>, n = hfl.size(); i &lt; n; ++i) {
<A NAME="757"></A>                        ((HandshakeFailedListener) hfl.get(i)).handshakeFailed(event);
<A NAME="758"></A>                    }
<A NAME="759"></A>                }
<A NAME="760"></A>                <FONT ID="Throw">throw</FONT> e;
<A NAME="761"></A>            }
<A NAME="762"></A>            <FONT ID="Return">return</FONT> s;
<A NAME="763"></A>        }
<A NAME="764"></A>    }
<A NAME="765"></A>
<A NAME="766"></A>
<A NAME="767"></A>    <FONT ID="FormalComment">/**
<A NAME="768"></A>     *  Description of the Class
<A NAME="769"></A>     *
<A NAME="770"></A>     * @author     gunter
<A NAME="771"></A>     * @created    March 5, 2003
<A NAME="772"></A>     */</FONT>
<A NAME="773"></A>    <FONT ID="Static">static</FONT> <FONT ID="Class">class</FONT> ConfigurationError <FONT ID="Extends">extends</FONT> Error
<A NAME="774"></A>    {
<A NAME="775"></A>        ConfigurationError(String msg, Exception x)
<A NAME="776"></A>        {
<A NAME="777"></A>            <FONT ID="Super">super</FONT>(msg, x);
<A NAME="778"></A>        }
<A NAME="779"></A>    }
<A NAME="780"></A>}
<A NAME="781"></A>
<A NAME="782"></A></pre><TABLE id="Header" border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td colspan="2" width="33%">&nbsp;</td>
<td align="center" colspan="2" width="33%">
<font size="4">SSLContextAdapterImpl</font>
</td>
<td align="right" colspan="2" width="33%"></td>
</tr>
</TABLE>

</BODY>
</HTML>